name: Documentation Check

on:
  pull_request:
    paths:
      - '**.md'
      - 'docs/**'
      - 'flame-academy/**'
  push:
    branches: [ main ]
    paths:
      - '**.md'
      - 'docs/**'

jobs:
  markdown-lint:
    name: Markdown Linting
    runs-on: ubuntu-latest
    
    steps:
      - name: üî• Checkout code
        uses: actions/checkout@v5
        
      - name: üìù Lint Markdown files
        run: |
          echo "Checking Markdown files for common issues..."
          # Basic checks for now - can add markdownlint-cli later
          
          # Check for broken relative links in markdown
          echo "Checking for broken relative links..."
          find . -name "*.md" -not -path "./node_modules/*" -exec grep -H "\](\.\./" {} \; || echo "No issues found"
          
      - name: ‚úÖ Documentation check passed
        run: echo "Documentation validation completed"

  link-checker:
    name: Check External Links
    runs-on: ubuntu-latest
    if: github.event_name == 'push'
    
    steps:
      - name: üî• Checkout code
        uses: actions/checkout@v5
        
      - name: üîó Check external links
        run: |
          echo "Checking documentation for broken links..."
          echo "Note: For comprehensive link checking, consider using:"
          echo "  - lychee (https://github.com/lycheeverse/lychee)"
          echo "  - markdown-link-check"
          echo "This is a basic validation step"
        continue-on-error: true

  doc-coverage:
    name: Documentation Coverage
    runs-on: ubuntu-latest
    
    steps:
      - name: üî• Checkout code
        uses: actions/checkout@v5
        
      - name: üìä Check documentation coverage
        run: |
          echo "Checking documentation coverage..."
          
          # List all Solidity contracts
          echo "Smart Contracts:"
          find contracts -name "*.sol" -not -path "*/node_modules/*" | wc -l
          
          # Check for README in major directories
          echo "Checking for README files in key directories..."
          for dir in contracts scripts test phase2 flame-academy portal; do
            if [ -d "$dir" ]; then
              if [ ! -f "$dir/README.md" ]; then
                echo "‚ö†Ô∏è Missing README.md in $dir/"
              else
                echo "‚úÖ README.md exists in $dir/"
              fi
            fi
          done
