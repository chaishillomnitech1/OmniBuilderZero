name: Deploy Contracts

on:
  workflow_dispatch:
    inputs:
      network:
        description: 'Network to deploy to'
        required: true
        type: choice
        options:
          - sepolia
          - scroll-sepolia
          - polygon-mumbai
          - mainnet
          - scroll
          - polygon
      contract:
        description: 'Contract to deploy (leave empty for all)'
        required: false
        type: string

jobs:
  deploy:
    name: Deploy to ${{ github.event.inputs.network }}
    runs-on: ubuntu-latest
    
    environment:
      name: ${{ github.event.inputs.network }}
    
    steps:
      - name: üî• Checkout code
        uses: actions/checkout@v5
        
      - name: üåü Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20.x'
          cache: 'npm'
          
      - name: üì¶ Install dependencies
        run: npm ci
        
      - name: üèóÔ∏è Compile contracts
        run: npm run compile
        
      - name: ‚ö†Ô∏è Deployment Pre-check
        run: |
          echo "üîç Deploying to: ${{ github.event.inputs.network }}"
          echo "üìã Contract: ${{ github.event.inputs.contract || 'ALL' }}"
          echo "üë§ Triggered by: ${{ github.actor }}"
          echo "‚è∞ Timestamp: $(date -u)"
          
      - name: üöÄ Deploy contracts
        run: |
          case "${{ github.event.inputs.network }}" in
            sepolia)
              npm run deploy:sepolia
              ;;
            scroll-sepolia)
              npm run deploy:scroll-sepolia
              ;;
            scroll)
              npm run deploy:scroll
              ;;
            polygon)
              npm run deploy:polygon
              ;;
            mainnet)
              echo "‚ö†Ô∏è WARNING: Deploying to MAINNET"
              npm run deploy:mainnet
              ;;
            *)
              echo "Unknown network"
              exit 1
              ;;
          esac
        env:
          PRIVATE_KEY: ${{ secrets.DEPLOYER_PRIVATE_KEY }}
          MAINNET_RPC_URL: ${{ secrets.MAINNET_RPC_URL }}
          SEPOLIA_RPC_URL: ${{ secrets.SEPOLIA_RPC_URL }}
          POLYGON_RPC_URL: ${{ secrets.POLYGON_RPC_URL }}
          SCROLL_RPC_URL: ${{ secrets.SCROLL_RPC_URL }}
          SCROLL_SEPOLIA_RPC_URL: ${{ secrets.SCROLL_SEPOLIA_RPC_URL }}
          ETHERSCAN_API_KEY: ${{ secrets.ETHERSCAN_API_KEY }}
          POLYGONSCAN_API_KEY: ${{ secrets.POLYGONSCAN_API_KEY }}
          SCROLLSCAN_API_KEY: ${{ secrets.SCROLLSCAN_API_KEY }}
          
      - name: ‚úÖ Deployment Summary
        if: success()
        run: |
          echo "‚úÖ Deployment to ${{ github.event.inputs.network }} completed successfully!"
          echo "üìù Please verify contracts on block explorer"
          
      - name: ‚ùå Deployment Failed
        if: failure()
        run: |
          echo "‚ùå Deployment to ${{ github.event.inputs.network }} failed!"
          echo "üîç Check logs above for details"
